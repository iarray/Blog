# SobenService 松本服务
## 1. 服务启动
	initDevice();			//初始化设备
    initMainDatabase();		//初始化数据库
    initUserInfoDatabase();	//初始化用户数据库
    initMsgCacheDatabase();	//初始化消息数据库
    initSerialPort();   	//初始化串口
    initYiJiaJia();     	//初始化一家家
    init8130();         	//初始化8130 
    initSounds();			//初始化提示音类（播放提示音）
    initCheckNetwork();		//初始化网络检测
    initCheckFingerState();	//初始化指纹状态检测
    initHandler(); 			//初始化消息处理
    initUSBFingerModule();	//初始化USB指纹模块
    initTimers();			//初始化定时器,放在initHandler 之后，定时检测门锁状态并上传
    initChatMac();			// 定时发送抓取MAC码
    initReaderIDCard();		//初始化ID卡读卡器

* 初始化设备
	* 初始化门的信息
	* 初始化gpio
	* 复位指纹  
  
* 初始化串口
	* 扩展板A协议
	* 扩展板B协议
	* 扩展板C协议 
  

* 初始化一家家
	* 初始化WebSocket发送和接收服务端的消息 
	* 定时器，每隔20秒检测在线情况（发送次数和接收次数相差大于3，当不在线,若不在线，关闭WebSocket重新建立连接）
	* 处理WebSocket接收到的文本消息
		* 一家家登录
		* 添加/删除指纹
		* 添加/删除IC卡
		* 控制门开关

* 初始化8130（硬件不熟）

* 初始化网络检测
	* 每隔一分钟Ping一下QQ.COM和baidu.com判断网络状态，如果3次ping不通则，关闭网卡重新打开

* 初始化消息处理
	* 指纹复位
	* USB指纹模块复位
	* 发送心跳码
	* 上报门磁状态到一家家
	* 发送MAC到一家家

* 初始化定时器
	* 每隔一秒检测一下，如果门有开锁上传到一家家，等待下次开锁再上传

* 定时抓取MAC
	* 每个一段时间向串口C发送字符 'G' 读取WIFI模块内部MAC缓存

* 初始化ID卡读卡器
	* 开一条线程循环从ID卡的栈里面读取ID卡的内容 